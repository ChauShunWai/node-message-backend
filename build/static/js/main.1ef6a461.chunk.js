(this["webpackJsonpnode-complete-social-network-prep"]=this["webpackJsonpnode-complete-social-network-prep"]||[]).push([[0],[,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";var a=n(0),o=n.n(a);n(50);e.a=function(t){return o.a.createElement("div",{className:"image",style:{backgroundImage:"url('".concat(t.imageUrl,"')"),backgroundSize:t.contain?"contain":"cover",backgroundPosition:t.left?"left":"center"}})}},,,,,,,,function(t,e,n){},,,function(t,e,n){"use strict";(function(t){var a=n(4),o=n(5),r=n(7),i=n(6),s=n(8),l=n(0),c=n.n(l),u=n(17),d=(n(58),function(e){function n(){var t,e;Object(a.a)(this,n);for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return(e=Object(r.a)(this,(t=Object(i.a)(n)).call.apply(t,[this].concat(s)))).state={title:"",author:"",date:"",image:"",content:""},e}return Object(s.a)(n,e),Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this,n={query:"\n        query FetchPost($postId: ID!){\n          post(postId: $postId) {\n            title\n            image\n            content\n            creator {\n              name\n            }\n            createdAt\n          }\n        }\n      ",variables:{postId:this.props.match.params.postId}};fetch("/graphql",{method:"POST",headers:{Authorization:"Bearer "+this.props.token,"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return t.json()})).then((function(n){console.log(n),fetch("/media/"+n.data.post.image,{method:"get",headers:{Authorization:"Bearer "+e.props.token}}).then((function(a){if(a.arrayBuffer().then((function(n){e.setState({image:"data:image/png;base64, "+t.from(n).toString("base64")})})),n.errors&&200!==n.errors[0].status)throw new Error("Failed to fetch post");e.setState({title:n.data.post.title,author:n.data.post.creator.name,date:n.data.post.createdAt,content:n.data.post.content})}))})).catch((function(t){console.log(t)}))}},{key:"render",value:function(){return c.a.createElement("section",{className:"single-post"},c.a.createElement("h1",null,this.state.title),c.a.createElement("h2",null,"Created by ",this.state.author," on ",this.state.date),c.a.createElement("div",{className:"single-post__image"},c.a.createElement(u.a,{contain:!0,imageUrl:this.state.image})),c.a.createElement("p",null,this.state.content))}}]),n}(l.Component));e.a=d}).call(this,n(54).Buffer)},function(t,e,n){t.exports=n(61)},,,,,function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},,,,,function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},,,,,function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),r=n(15),i=n.n(r),s=n(12),l=(n(34),n(4)),c=n(5),u=n(7),d=n(6),m=n(8),h=n(13),p=(n(35),function(t){return o.a.createElement(a.Fragment,null,o.a.createElement("header",{className:"main-header"},t.header),t.mobileNav,o.a.createElement("main",{className:"content"},t.children))}),g=(n(36),function(t){return i.a.createPortal(o.a.createElement("div",{className:["backdrop",t.open?"open":""].join(" "),onClick:t.onClick}),document.getElementById("backdrop-root"))}),f=(n(37),function(t){return o.a.createElement("div",{className:"toolbar"},t.children)}),v=(n(38),function(t){return o.a.createElement("button",{className:"mobile-toggle",onClick:t.onOpen},o.a.createElement("span",{className:"mobile-toggle__bar"}),o.a.createElement("span",{className:"mobile-toggle__bar"}),o.a.createElement("span",{className:"mobile-toggle__bar"}))}),E=(n(39),function(t){return o.a.createElement("h1",{className:"logo"},"MessageNode")}),b=n(18),w=(n(40),[{id:"feed",text:"Feed",link:"/",auth:!0},{id:"login",text:"Login",link:"/",auth:!1},{id:"signup",text:"Signup",link:"/signup",auth:!1}]),y=function(t){return[].concat(Object(b.a)(w.filter((function(e){return e.auth===t.isAuth})).map((function(e){return o.a.createElement("li",{key:e.id,className:["navigation-item",t.mobile?"mobile":""].join(" ")},o.a.createElement(s.c,{to:e.link,exact:!0,onClick:t.onChoose},e.text))}))),[t.isAuth&&o.a.createElement("li",{className:"navigation-item",key:"logout"},o.a.createElement("button",{onClick:t.onLogout},"Logout"))])},P=(n(45),function(t){return o.a.createElement("nav",{className:"main-nav"},o.a.createElement(v,{onOpen:t.onOpenMobileNav}),o.a.createElement("div",{className:"main-nav__logo"},o.a.createElement(s.c,{to:"/"},o.a.createElement(E,null))),o.a.createElement("div",{className:"spacer"}),o.a.createElement("ul",{className:"main-nav__items"},o.a.createElement(y,{isAuth:t.isAuth,onLogout:t.onLogout})))}),S=(n(46),function(t){return o.a.createElement("nav",{className:["mobile-nav",t.open?"open":""].join(" ")},o.a.createElement("ul",{className:["mobile-nav__items",t.mobile?"mobile":""].join(" ")},o.a.createElement(y,{mobile:!0,onChoose:t.onChooseItem,isAuth:t.isAuth,onLogout:t.onLogout})))}),j=(n(47),function(t){return t.link?o.a.createElement(s.b,{className:["button","button--".concat(t.design),"button--".concat(t.mode)].join(" "),to:t.link},t.children):o.a.createElement("button",{className:["button","button--".concat(t.design),"button--".concat(t.mode)].join(" "),onClick:t.onClick,disabled:t.disabled||t.loading,type:t.type},t.loading?"Loading...":t.children)}),O=(n(48),function(t){return i.a.createPortal(o.a.createElement("div",{className:"modal"},o.a.createElement("header",{className:"modal__header"},o.a.createElement("h1",null,t.title)),o.a.createElement("div",{className:"modal__content"},t.children),o.a.createElement("div",{className:"modal__actions"},o.a.createElement(j,{design:"danger",mode:"flat",onClick:t.onCancelModal},"Cancel"),o.a.createElement(j,{mode:"raised",onClick:t.onAcceptModal,disabled:!t.acceptEnabled,loading:t.isLoading},"Accept"))),document.getElementById("modal-root"))}),C=function(t){return o.a.createElement(a.Fragment,null,t.error&&o.a.createElement(g,{onClick:t.onHandle}),t.error&&o.a.createElement(O,{title:"An Error Occurred",onCancelModal:t.onHandle,onAcceptModal:t.onHandle,acceptEnabled:!0},o.a.createElement("p",null,t.error.message)))},F=n(1),N=(n(49),function(t){return o.a.createElement("article",{className:"post"},o.a.createElement("header",{className:"post__header"},o.a.createElement("h3",{className:"post__meta"},"Posted by ",t.author," on ",t.date),o.a.createElement("h1",{className:"post__title"},t.title)),o.a.createElement("div",{className:"post__actions"},o.a.createElement(j,{mode:"flat",link:t.id},"View"),o.a.createElement(j,{mode:"flat",onClick:t.onStartEdit},"Edit"),o.a.createElement(j,{mode:"flat",design:"danger",onClick:t.onDelete},"Delete")))}),k=n(10),I=(n(25),function(t){return o.a.createElement("div",{className:"input"},t.label&&o.a.createElement("label",{htmlFor:t.id},t.label),"input"===t.control&&o.a.createElement("input",{className:[t.valid?"valid":"invalid",t.touched?"touched":"untouched"].join(" "),type:t.type,id:t.id,required:t.required,value:t.value,placeholder:t.placeholder,onChange:function(e){return t.onChange(t.id,e.target.value,e.target.files)},onBlur:t.onBlur}),"textarea"===t.control&&o.a.createElement("textarea",{className:[t.valid?"valid":"invalid",t.touched?"touched":"untouched"].join(" "),id:t.id,rows:t.rows,required:t.required,value:t.value,onChange:function(e){return t.onChange(t.id,e.target.value)},onBlur:t.onBlur}))}),H=function(t){return o.a.createElement("div",{className:"input"},o.a.createElement("label",{htmlFor:t.id},t.label),o.a.createElement("input",{className:[t.valid?"valid":"invalid",t.touched?"touched":"untouched"].join(" "),type:"file",id:t.id,onChange:function(e){return t.onChange(t.id,e.target.value,e.target.files)},onBlur:t.onBlur}))},_=n(17),A=function(t){return""!==t.trim()},B=function(t){return function(e){var n=!0;return t.min&&(n=n&&e.trim().length>=t.min),t.max&&(n=n&&e.trim().length<=t.max),n}},L=function(t){return/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t)},$=function(t){var e=new FileReader,n=new Promise((function(t,n){e.onload=function(e){return t(e.target.result)},e.onerror=function(t){return n(t)}}));return void 0!==t&&e.readAsDataURL(t),n},x={title:{value:"",valid:!1,touched:!1,validators:[A,B({min:5})]},image:{value:"",valid:!1,touched:!1,validators:[A]},content:{value:"",valid:!1,touched:!1,validators:[A,B({min:5})]}},D=function(t){function e(){var t,n;Object(l.a)(this,e);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(u.a)(this,(t=Object(d.a)(e)).call.apply(t,[this].concat(o)))).state={postForm:x,formIsValid:!1,imagePreview:null},n.postInputChangeHandler=function(t,e,a){a&&$(a[0]).then((function(t){n.setState({imagePreview:t})})).catch((function(t){n.setState({imagePreview:null})})),n.setState((function(n){var o=!0,r=!0,i=!1,s=void 0;try{for(var l,c=n.postForm[t].validators[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value;o=o&&u(e)}}catch(p){i=!0,s=p}finally{try{r||null==c.return||c.return()}finally{if(i)throw s}}var d=Object(F.a)({},n.postForm,Object(k.a)({},t,Object(F.a)({},n.postForm[t],{valid:o,value:a?a[0]:e}))),m=!0;for(var h in d)m=m&&d[h].valid;return{postForm:d,formIsValid:m}}))},n.inputBlurHandler=function(t){n.setState((function(e){return{postForm:Object(F.a)({},e.postForm,Object(k.a)({},t,Object(F.a)({},e.postForm[t],{touched:!0})))}}))},n.cancelPostChangeHandler=function(){n.setState({postForm:x,formIsValid:!1}),n.props.onCancelEdit()},n.acceptPostChangeHandler=function(){var t={title:n.state.postForm.title.value,image:n.state.postForm.image.value,content:n.state.postForm.content.value};n.props.onFinishEdit(t),n.setState({postForm:x,formIsValid:!1,imagePreview:null})},n}return Object(m.a)(e,t),Object(c.a)(e,[{key:"componentDidUpdate",value:function(t,e){if(this.props.editing&&t.editing!==this.props.editing&&t.selectedPost!==this.props.selectedPost){var n={title:Object(F.a)({},e.postForm.title,{value:this.props.selectedPost.title,valid:!0}),image:Object(F.a)({},e.postForm.image,{value:this.props.selectedPost.imagePath,valid:!0}),content:Object(F.a)({},e.postForm.content,{value:this.props.selectedPost.content,valid:!0})};this.setState({postForm:n,formIsValid:!0})}}},{key:"render",value:function(){return this.props.editing?o.a.createElement(a.Fragment,null,o.a.createElement(g,{onClick:this.cancelPostChangeHandler}),o.a.createElement(O,{title:"New Post",acceptEnabled:this.state.formIsValid,onCancelModal:this.cancelPostChangeHandler,onAcceptModal:this.acceptPostChangeHandler,isLoading:this.props.loading},o.a.createElement("form",null,o.a.createElement(I,{id:"title",label:"Title",control:"input",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"title"),valid:this.state.postForm.title.valid,touched:this.state.postForm.title.touched,value:this.state.postForm.title.value}),o.a.createElement(H,{id:"image",label:"Image",control:"input",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"image"),valid:this.state.postForm.image.valid,touched:this.state.postForm.image.touched}),o.a.createElement("div",{className:"new-post__preview-image"},!this.state.imagePreview&&o.a.createElement("p",null,"Please choose an image."),this.state.imagePreview&&o.a.createElement(_.a,{imageUrl:this.state.imagePreview,contain:!0,left:!0})),o.a.createElement(I,{id:"content",label:"Content",control:"textarea",rows:"5",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"content"),valid:this.state.postForm.content.valid,touched:this.state.postForm.content.touched,value:this.state.postForm.content.value})))):null}}]),e}(a.Component),q=(n(51),function(t){return o.a.createElement("div",{className:"paginator"},t.children,o.a.createElement("div",{className:"paginator__controls"},t.currentPage>1&&o.a.createElement("button",{className:"paginator__control",onClick:t.onPrevious},"Previous"),t.currentPage<t.lastPage&&o.a.createElement("button",{className:"paginator__control",onClick:t.onNext},"Next")))}),T=(n(52),function(t){return o.a.createElement("div",{className:"loader"},o.a.createElement("div",null),o.a.createElement("div",null),o.a.createElement("div",null),o.a.createElement("div",null))}),z=(n(53),function(t){function e(){var t,n;Object(l.a)(this,e);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(u.a)(this,(t=Object(d.a)(e)).call.apply(t,[this].concat(o)))).state={isEditing:!1,posts:[],totalPosts:0,editPost:null,status:"",postPage:1,postsLoading:!0,editLoading:!1},n.loadPosts=function(t){t&&n.setState({postsLoading:!0,posts:[]});var e=n.state.postPage;"next"===t&&(e++,n.setState({postPage:e})),"previous"===t&&(e--,n.setState({postPage:e}));var a={query:"\n        query FetchPosts($page: Int!) {\n          posts(page: $page) {\n            posts {\n              _id\n              title\n              content\n              image\n              creator {\n                name\n              }\n              createdAt\n            }\n            totalPosts\n          }\n        }\n      ",variables:{page:e}};fetch("/graphql",{method:"POST",body:JSON.stringify(a),headers:{Authorization:"Bearer "+n.props.token,"Content-Type":"application/json"}}).then((function(t){return t.json()})).then((function(t){if(t.errors&&401===t.errors[0].status)throw new Error("Not authenticated. ");if(t.errors&&401!==t.errors[0].status)throw new Error("Fetching posts failed. ");n.setState({posts:t.data.posts.posts.map((function(t){return Object(F.a)({},t,{imagePath:t.image})})),totalPosts:t.data.posts.totalPosts,postsLoading:!1})})).catch(n.catchError)},n.statusUpdateHandler=function(t){t.preventDefault();var e={query:"\n        mutation UpdateStatus($status: String!){\n          updateStatus(status: $status) {\n            status\n          }\n        }\n      ",variables:{status:n.state.status}};fetch("/graphql",{method:"POST",headers:{Authorization:"Bearer "+n.props.token,"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){return t.json()})).then((function(t){if(t.errors)throw new Error("Can't update status!");console.log(t)})).catch(n.catchError)},n.newPostHandler=function(){n.setState({isEditing:!0})},n.startEditPostHandler=function(t){n.setState((function(e){return{isEditing:!0,editPost:Object(F.a)({},e.posts.find((function(e){return e._id===t})))}}))},n.cancelEditHandler=function(){n.setState({isEditing:!1,editPost:null})},n.finishEditHandler=function(t){n.setState({editLoading:!0});var e=new FormData;e.append("image",t.image),n.state.editPost&&e.append("oldPath",n.state.editPost.imagePath),fetch("/post-image",{method:"PUT",headers:{Authorization:"Bearer "+n.props.token},body:e}).then((function(t){return t.json()})).then((function(e){console.log(e);var a=e.filePath?e.filePath.replace("\\","/"):n.state.editPost.imagePath,o={query:"\n          mutation CreatePost($title:String!,$image: String!,$content:String!) {\n            createPost(postInput: {\n              title: $title\n              image: $image\n              content: $content\n            }) {\n              _id\n              title\n              image\n              content\n              creator {\n                name\n              }\n              createdAt\n            }\n          }\n        ",variables:{title:t.title,image:a,content:t.content}};if(n.state.editPost){var r=t.title,i=t.content;o={query:"\n            mutation UpdatePost($_id:ID!, $title:String!,$image:String!,$content:String!){\n              updatePost(\n                postId: $_id,\n                postInput: {\n                title: $title\n                image: $image\n                content: $content\n              }) {\n                _id\n                title\n                image\n                content\n                creator {\n                  name\n                }\n                createdAt\n              }\n            }\n          ",variables:{_id:n.state.editPost._id,title:r,image:a,content:i}}}return fetch("/graphql",{method:"POST",body:JSON.stringify(o),headers:{Authorization:"Bearer "+n.props.token,"Content-Type":"application/json"}})})).then((function(t){return t.json()})).then((function(t){if(console.log(t),t.errors&&422===t.errors[0].status)throw new Error(t.errors[0].data.reduce((function(t,e){return t+e.message}),""));if(t.errors&&403===t.errors[0].status)throw new Error("Not authorized. ");if(t.errors&&401===t.errors[0].status)throw new Error("Invalid user. ");if(t.errors&&![422,401,403].includes(t.errors[0].status))throw new Error("Adding post failed. ");var e=n.state.editPost?t.data.updatePost:t.data.createPost,a={_id:e._id,title:e.title,content:e.content,creator:e.creator,createdAt:e.createdAt,imagePath:e.image};n.setState((function(t){var e=Object(b.a)(t.posts);t.editPost?e[t.posts.findIndex((function(e){return e._id===t.editPost._id}))]=a:e.unshift(a);return e.length>2&&e.pop(),{posts:e,isEditing:!1,editPost:null,editLoading:!1,totalPosts:t.totalPosts+1}}))})).catch((function(t){var e;console.log(t),"Failed to fetch"===t.message&&(e=new Error("File size must be less than 512KB")),n.setState({isEditing:!1,editPost:null,editLoading:!1,error:e||t})}))},n.statusInputChangeHandler=function(t,e){n.setState({status:e})},n.deletePostHandler=function(t){n.setState({postsLoading:!0});var e={query:"\n        mutation deletePost($postId: ID!) {\n          deletePost(postId: $postId)\n        }\n      ",variables:{postId:t}};fetch("/graphql",{method:"POST",headers:{Authorization:"Bearer "+n.props.token,"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){return t.json()})).then((function(t){if(console.log(t),t.errors&&403===t.errors[0].status)throw new Error("Not authorized");if(t.errors)throw new Error("Deleting a post failed!");n.loadPosts()})).catch((function(t){console.log(t),n.setState({postsLoading:!1,error:t})}))},n.errorHandler=function(){n.setState({error:null})},n.catchError=function(t){n.setState({error:t})},n}return Object(m.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){var t=this;fetch("/graphql",{method:"POST",headers:{Authorization:"Bearer "+this.props.token,"Content-Type":"application/json"},body:JSON.stringify({query:"\n        {\n          user {\n            status\n          }  \n        }\n      "})}).then((function(t){return t.json()})).then((function(e){if(e.errors)throw new Error("Failed to fetch user status.");t.setState({status:e.data.user.status})})).catch(this.catchError),this.loadPosts()}},{key:"render",value:function(){var t=this;return o.a.createElement(a.Fragment,null,o.a.createElement(C,{error:this.state.error,onHandle:this.errorHandler}),o.a.createElement(D,{editing:this.state.isEditing,selectedPost:this.state.editPost,loading:this.state.editLoading,onCancelEdit:this.cancelEditHandler,onFinishEdit:this.finishEditHandler}),o.a.createElement("section",{className:"feed__status"},o.a.createElement("form",{onSubmit:this.statusUpdateHandler},o.a.createElement(I,{type:"text",placeholder:"Your status",control:"input",onChange:this.statusInputChangeHandler,value:this.state.status}),o.a.createElement(j,{mode:"flat",type:"submit"},"Update"))),o.a.createElement("section",{className:"feed__control"},o.a.createElement(j,{mode:"raised",design:"accent",onClick:this.newPostHandler},"New Post")),o.a.createElement("section",{className:"feed"},this.state.postsLoading&&o.a.createElement("div",{style:{textAlign:"center",marginTop:"2rem"}},o.a.createElement(T,null)),this.state.posts.length<=0&&!this.state.postsLoading?o.a.createElement("p",{style:{textAlign:"center"}},"No posts found."):null,!this.state.postsLoading&&o.a.createElement(q,{onPrevious:this.loadPosts.bind(this,"previous"),onNext:this.loadPosts.bind(this,"next"),lastPage:Math.ceil(this.state.totalPosts/2),currentPage:this.state.postPage},this.state.posts.map((function(e){return o.a.createElement(N,{key:e._id,id:e._id,author:e.creator.name,date:e.createdAt,title:e.title,image:e.imageUrl,content:e.content,onStartEdit:t.startEditPostHandler.bind(t,e._id),onDelete:t.deletePostHandler.bind(t,e._id)})})))))}}]),e}(a.Component)),M=n(28),U=(n(59),function(t){return o.a.createElement("section",{className:"auth-form"},t.children)}),V=function(t){function e(){var t,n;Object(l.a)(this,e);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(u.a)(this,(t=Object(d.a)(e)).call.apply(t,[this].concat(o)))).state={loginForm:{email:{value:"",valid:!1,touched:!1,validators:[A,L]},password:{value:"",valid:!1,touched:!1,validators:[A,B({min:5})]},formIsValid:!1}},n.inputChangeHandler=function(t,e){n.setState((function(n){var a=!0,o=!0,r=!1,i=void 0;try{for(var s,l=n.loginForm[t].validators[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;a=a&&c(e)}}catch(h){r=!0,i=h}finally{try{o||null==l.return||l.return()}finally{if(r)throw i}}var u=Object(F.a)({},n.loginForm,Object(k.a)({},t,Object(F.a)({},n.loginForm[t],{valid:a,value:e}))),d=!0;for(var m in u)d=d&&u[m].valid;return{loginForm:u,formIsValid:d}}))},n.inputBlurHandler=function(t){n.setState((function(e){return{loginForm:Object(F.a)({},e.loginForm,Object(k.a)({},t,Object(F.a)({},e.loginForm[t],{touched:!0})))}}))},n}return Object(m.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){var t=this;return o.a.createElement(U,null,o.a.createElement("form",{onSubmit:function(e){return t.props.onLogin(e,{email:t.state.loginForm.email.value,password:t.state.loginForm.password.value})}},o.a.createElement(I,{id:"email",label:"Your E-Mail",type:"email",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"email"),value:this.state.loginForm.email.value,valid:this.state.loginForm.email.valid,touched:this.state.loginForm.email.touched}),o.a.createElement(I,{id:"password",label:"Password",type:"password",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"password"),value:this.state.loginForm.password.value,valid:this.state.loginForm.password.valid,touched:this.state.loginForm.password.touched}),o.a.createElement(j,{design:"raised",type:"submit",loading:this.props.loading},"Login")))}}]),e}(a.Component),J=function(t){function e(){var t,n;Object(l.a)(this,e);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(u.a)(this,(t=Object(d.a)(e)).call.apply(t,[this].concat(o)))).state={signupForm:{email:{value:"",valid:!1,touched:!1,validators:[A,L]},password:{value:"",valid:!1,touched:!1,validators:[A,B({min:5})]},name:{value:"",valid:!1,touched:!1,validators:[A]},formIsValid:!1}},n.inputChangeHandler=function(t,e){n.setState((function(n){var a=!0,o=!0,r=!1,i=void 0;try{for(var s,l=n.signupForm[t].validators[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;a=a&&c(e)}}catch(h){r=!0,i=h}finally{try{o||null==l.return||l.return()}finally{if(r)throw i}}var u=Object(F.a)({},n.signupForm,Object(k.a)({},t,Object(F.a)({},n.signupForm[t],{valid:a,value:e}))),d=!0;for(var m in u)d=d&&u[m].valid;return{signupForm:u,formIsValid:d}}))},n.inputBlurHandler=function(t){n.setState((function(e){return{signupForm:Object(F.a)({},e.signupForm,Object(k.a)({},t,Object(F.a)({},e.signupForm[t],{touched:!0})))}}))},n}return Object(m.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){var t=this;return o.a.createElement(U,null,o.a.createElement("form",{onSubmit:function(e){return t.props.onSignup(e,t.state)}},o.a.createElement(I,{id:"email",label:"Your E-Mail",type:"email",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"email"),value:this.state.signupForm.email.value,valid:this.state.signupForm.email.valid,touched:this.state.signupForm.email.touched}),o.a.createElement(I,{id:"name",label:"Your Name",type:"text",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"name"),value:this.state.signupForm.name.value,valid:this.state.signupForm.name.valid,touched:this.state.signupForm.name.touched}),o.a.createElement(I,{id:"password",label:"Password",type:"password",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"password"),value:this.state.signupForm.password.value,valid:this.state.signupForm.password.valid,touched:this.state.signupForm.password.touched}),o.a.createElement(j,{design:"raised",type:"submit",loading:this.props.loading},"Signup")))}}]),e}(a.Component),Y=(n(60),function(t){function e(){var t,n;Object(l.a)(this,e);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(u.a)(this,(t=Object(d.a)(e)).call.apply(t,[this].concat(o)))).state={showBackdrop:!1,showMobileNav:!1,isAuth:!1,token:null,userId:null,authLoading:!1,error:null},n.mobileNavHandler=function(t){n.setState({showMobileNav:t,showBackdrop:t})},n.backdropClickHandler=function(){n.setState({showBackdrop:!1,showMobileNav:!1,error:null})},n.logoutHandler=function(){n.setState({isAuth:!1,token:null}),localStorage.removeItem("token"),localStorage.removeItem("expiryDate"),localStorage.removeItem("userId")},n.loginHandler=function(t,e){t.preventDefault();var a=e.email,o=e.password;n.setState({authLoading:!0});var r={query:"\n        query Login($email:String!,$password:String!){\n          login(\n            email: $email,\n            password: $password\n          ) {\n            token\n            userId\n          }\n        }\n      ",variables:{email:a,password:o}};fetch("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((function(t){return t.json()})).then((function(t){if(console.log(t),t.errors&&422===t.errors[0].status)throw new Error(t.errors[0].data.reduce((function(t,e){return t+e.message}),""));if(t.errors&&401===t.errors[0].status)throw new Error("Wrong email or password. ");if(t.errors&&![422,401].includes(t.errors[0].status))throw new Error("Login failed. ");var e=t.data.login.token,a=t.data.login.userId;n.setState({isAuth:!0,token:e,authLoading:!1,userId:a}),localStorage.setItem("token",e),localStorage.setItem("userId",a);var o=new Date((new Date).getTime()+36e5);localStorage.setItem("expiryDate",o.toISOString()),n.setAutoLogout(36e5)})).catch((function(t){console.log(t),n.setState({isAuth:!1,authLoading:!1,error:t})}))},n.signupHandler=function(t,e){t.preventDefault(),n.setState({authLoading:!0});var a={query:"\n        mutation Signup($email:String!, $name:String!,$password:String!) {\n          createUser(userInput: {\n            email: $email,\n            name: $name,\n            password: $password\n          }) {\n            _id\n            email\n          }\n        }\n      ",variables:{email:e.signupForm.email.value,name:e.signupForm.name.value,password:e.signupForm.password.value}};fetch("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((function(t){return t.json()})).then((function(t){if(console.log(t),t.errors&&422===t.errors[0].status)throw new Error(t.errors[0].data.reduce((function(t,e){return t+e.message}),""));if(t.errors&&409===t.errors[0].status)throw new Error("User Exists");if(t.errors&&![422,409].includes(t.errors[0].status))throw new Error("Signup failed. ");n.setState({isAuth:!1,authLoading:!1}),n.props.history.replace("/")})).catch((function(t){console.log(t),n.setState({isAuth:!1,authLoading:!1,error:t})}))},n.setAutoLogout=function(t){setTimeout((function(){n.logoutHandler()}),t)},n.errorHandler=function(){n.setState({error:null})},n}return Object(m.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){var t=localStorage.getItem("token"),e=localStorage.getItem("expiryDate");if(t&&e)if(new Date(e)<=new Date)this.logoutHandler();else{var n=localStorage.getItem("userId"),a=new Date(e).getTime()-(new Date).getTime();this.setState({isAuth:!0,token:t,userId:n}),this.setAutoLogout(a)}}},{key:"render",value:function(){var t=this,e=o.a.createElement(h.d,null,o.a.createElement(h.b,{path:"/",exact:!0,render:function(e){return o.a.createElement(V,Object.assign({},e,{onLogin:t.loginHandler,loading:t.state.authLoading}))}}),o.a.createElement(h.b,{path:"/signup",exact:!0,render:function(e){return o.a.createElement(J,Object.assign({},e,{onSignup:t.signupHandler,loading:t.state.authLoading}))}}),o.a.createElement(h.a,{to:"/"}));return this.state.isAuth&&(e=o.a.createElement(h.d,null,o.a.createElement(h.b,{path:"/",exact:!0,render:function(e){return o.a.createElement(z,{userId:t.state.userId,token:t.state.token})}}),o.a.createElement(h.b,{path:"/:postId",render:function(e){return o.a.createElement(M.a,Object.assign({},e,{userId:t.state.userId,token:t.state.token}))}}),o.a.createElement(h.a,{to:"/"}))),o.a.createElement(a.Fragment,null,this.state.showBackdrop&&o.a.createElement(g,{onClick:this.backdropClickHandler}),o.a.createElement(C,{error:this.state.error,onHandle:this.errorHandler}),o.a.createElement(p,{header:o.a.createElement(f,null,o.a.createElement(P,{onOpenMobileNav:this.mobileNavHandler.bind(this,!0),onLogout:this.logoutHandler,isAuth:this.state.isAuth})),mobileNav:o.a.createElement(S,{open:this.state.showMobileNav,mobile:!0,onChooseItem:this.mobileNavHandler.bind(this,!1),onLogout:this.logoutHandler,isAuth:this.state.isAuth})}),e)}}]),e}(a.Component)),R=Object(h.g)(Y);i.a.render(o.a.createElement(s.a,null,o.a.createElement(R,null)),document.getElementById("root"))}],[[29,1,2]]]);
//# sourceMappingURL=main.1ef6a461.chunk.js.map